<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØµÙØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0b1a33;
  color:#fff;
}
.header{
  padding:15px;
  text-align:center;
  background:#08142a;
}
.box{
  margin:15px;
  padding:15px;
  background:#101f3f;
  border-radius:12px;
}
.task{
  background:#162a55;
  padding:12px;
  margin-bottom:10px;
  border-radius:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.task button{
  padding:6px 15px;
  border:none;
  border-radius:20px;
  background:#00c853;
  color:#fff;
  font-weight:bold;
}
.task button[disabled]{background:#555;}
#upgradeBox{text-align:center;margin:20px;}
#upgradeBox a{
  display:inline-block;padding:12px 30px;
  background:#0088cc;color:#fff;border-radius:30px;
  text-decoration:none;font-weight:bold;
}
.note{text-align:center;font-size:14px;opacity:.8;}
/* Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ */
#videoModal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  z-index:9999;
  align-items:center;
  justify-content:center;
}
#videoModal .content{
  width:90%;max-width:600px;
  background:#08142a;border-radius:14px;padding:12px;
  position:relative;
}
#videoModal button{
  position:absolute;top:8px;left:8px;
  width:32px;height:32px;border:none;
  border-radius:50%;background:#c62828;
  color:#fff;font-size:18px;
}
</style>
</head>

<body>

<div class="header">
  <div>Ø±ØµÙŠØ¯Ùƒ: <span id="balance">0</span> Ø¯Ø¬</div>
  <div>Ù…Ø³ØªÙˆØ§Ùƒ: <span id="level">0</span></div>
</div>

<div id="upgradeBox">
  <a href="https://t.me/USERNAME_TA3EK" target="_blank">ğŸš€ ØªØ±Ù‚ÙŠØ© Ù…Ø³ØªÙˆØ§Ùƒ</a>
  <div class="note">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1</div>
</div>

<div class="box">
  <h3>ğŸ“º Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…</h3>
  <div id="tasks"></div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
<div id="videoModal">
  <div class="content">
    <button onclick="closeVideo()">Ã—</button>
    <iframe id="videoFrame"
      width="100%" height="300"
      src=""
      frameborder="0"
      allow="autoplay; encrypted-media"
      allowfullscreen
      style="border-radius:10px;">
    </iframe>
    <div id="watchText" style="text-align:center;margin-top:10px;">
      ÙŠØ±Ø¬Ù‰ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged }
  from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc }
  from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyAa6ETi1DmEI-3nVuqjpsaodT0rXsP8bIw",
  authDomain: "aple-21978.firebaseapp.com",
  projectId: "aple-21978",
  storageBucket: "aple-21978.firebasestorage.app",
  messagingSenderId: "1013598113300",
  appId: "1:1013598113300:web:5e71138b4e75e2a2752101"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

/* Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
const TOTAL_TASKS = 5;
const VIDEOS = [
  "Vb0TGoHe5L0",
  "ji8b2Vj7z54",
  "Nl5DpBh8Xec",
  "5PLn2LKUQZU",
  "UJTL1kPMFcY"
];
const LEVEL_EARNINGS = {
  0:0,1:100,2:230,3:480,4:800,5:1200,6:1900,7:2500
};

/* Ø¹Ù†Ø§ØµØ± */
const balanceEl = document.getElementById("balance");
const levelEl   = document.getElementById("level");
const tasksBox  = document.getElementById("tasks");
const upgradeBox= document.getElementById("upgradeBox");

function todayKey(){return new Date().toISOString().split("T")[0];}

let user, userRef, timer, secondsLeft, currentTask;

/* ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ */
signInAnonymously(auth);

onAuthStateChanged(auth, async(u)=>{
  if(!u) return;

  userRef = doc(db,"users",u.uid);
  const snap = await getDoc(userRef);

  if(!snap.exists()){
    user = { level:0,balance:0,done:[],lastDay:todayKey() };
    await setDoc(userRef,user);
  }else user = snap.data();

  if(user.lastDay !== todayKey()){
    user.done = [];
    user.lastDay= todayKey();
    await updateDoc(userRef,{done:user.done,lastDay:user.lastDay});
  }

  updateUI();
});

function updateUI(){
  balanceEl.textContent = user.balance;
  levelEl.textContent   = user.level;
  upgradeBox.style.display = user.level===0?"block":"none";

  tasksBox.innerHTML = "";
  for(let i=0;i<TOTAL_TASKS;i++){
    const done = user.done.includes(i);
    tasksBox.innerHTML += `
      <div class="task">
        <span>ÙÙŠØ¯ÙŠÙˆ ${i+1}</span>
        <button ${done?"disabled":""} onclick="startTask(${i})">
          ${done?"ØªÙ…":"Ù…Ø´Ø§Ù‡Ø¯Ø©"}
        </button>
      </div>`;
  }
}

/* Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙŠØ¯ÙŠÙˆ */
window.startTask = function(i){
  if(user.done.includes(i)) return;

  currentTask = i;
  secondsLeft = 50;

  const id = VIDEOS[i];
  document.getElementById("videoFrame").src =
    `https://www.youtube.com/embed/${id}?autoplay=1`;

  document.getElementById("videoModal").style.display="flex";
  document.getElementById("watchText").textContent="Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: 50 Ø«ÙˆØ§Ù†ÙŠ";

  timer = setInterval(async()=>{
    secondsLeft--;
    document.getElementById("watchText").textContent =
      "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: " + secondsLeft + " Ø«ÙˆØ§Ù†ÙŠ";

    if(secondsLeft<=0){
      clearInterval(timer);

      user.done.push(currentTask);

      const daily = LEVEL_EARNINGS[user.level] || 0;
      if(user.level>0){
        user.balance += daily/TOTAL_TASKS;
      }

      await updateDoc(userRef,{
        done:user.done,
        balance:user.balance
      });

      closeVideo();
      updateUI();
    }
  },1000);
};

window.closeVideo = function(){
  clearInterval(timer);
  document.getElementById("videoFrame").src="";
  document.getElementById("videoModal").style.display="none";
};
</script>

</body>
</html>
