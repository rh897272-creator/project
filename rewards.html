<!DOCTYPE html>
<html lang="ar">
<head>
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">

<style>
html, body{
  width:100%;
  height:100%;
}

body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#020b1f,#041b3a);
  color:#fff;
  font-family:Arial;
}

.box{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

/* ğŸ Ø§Ù„Ù‡Ø¯ÙŠØ© */
.gift{
  font-size:55px;
  animation:pulse 1.8s infinite;
  margin-bottom:10px;
}

@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.15)}
  100%{transform:scale(1)}
}

/* âœ¨ Ù„Ù…Ø¹Ø© */
.box::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:25px;
  background:linear-gradient(120deg,transparent,rgba(255,255,255,.15),transparent);
  animation:shine 3s infinite;
}

@keyframes shine{
  0%{transform:translateX(-100%)}
  100%{transform:translateX(100%)}
}

.title{
  font-size:26px;
  color:#00ffd5;
}

#clock{
  color:#ffd54f;
  font-size:16px;
  margin:8px 0;
}

.status{
  margin:12px 0;
}

.amount{
  font-size:50px;
  color:#00ffd5;
  margin:15px 0;
}

button{
  background:#00ffd5;
  color:#000;
  border:none;
  padding:15px 40px;
  font-size:18px;
  border-radius:30px;
  cursor:pointer;
  transition:.3s;
}

button:hover{transform:scale(1.05)}

button:disabled{
  background:#555;
  color:#aaa;
}
</style>
</head>

<body>

<div class="box">
  <div class="gift">ğŸ</div>
  <div class="title">Ø±ØµÙŠØ¯ ÙŠÙˆÙ…ÙŠ Ø«Ø§Ø¨Øª</div>
  <div id="clock">â° --:--:--</div>
  <div id="status" class="status">ØªØ­Ù…ÙŠÙ„...</div>
  <div id="amount" class="amount">0 Ø¯Ø¬</div>
  <button id="btn" disabled>ğŸ Ø§Ø³ØªÙ„Ø§Ù… 20 Ø¯Ø¬</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAa6ETi1DmEI-3nVuqjpsaodT0rXsP8bIw",
  authDomain: "aple-21978.firebaseapp.com",
  projectId: "aple-21978",
  storageBucket: "aple-21978.appspot.com",
  messagingSenderId: "1013598113300",
  appId: "1:1013598113300:web:5e71138b4e75e2a2752101"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const GIFT = 20;
const DAY  = 86400000;

const statusDiv = document.getElementById("status");
const amountDiv = document.getElementById("amount");
const btn = document.getElementById("btn");

signInAnonymously(auth);

onAuthStateChanged(auth, async (user)=>{
  if(!user) return;

  const ref = doc(db,"users",user.uid);
  const snap = await getDoc(ref);

  if(!snap.exists()){
    await setDoc(ref,{ balance:0, lastGift:0 });
  }
  load(ref);
});

async function load(ref){
  const snap = await getDoc(ref);
  const d = snap.data();

  const balance = Number(d.balance)||0;
  const lastGift = Number(d.lastGift)||0;

  amountDiv.innerHTML = balance + " Ø¯Ø¬";

  if(lastGift===0 || Date.now()-lastGift>=DAY){
    statusDiv.innerHTML = "ğŸ Ø§Ù„Ù‡Ø¯ÙŠØ© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…";
    btn.disabled = false;
  }else{
    btn.disabled = true;
    countdown(DAY-(Date.now()-lastGift));
  }
}

function countdown(ms){
  const t=setInterval(()=>{
    ms-=1000;
    if(ms<=0){
      clearInterval(t);
      statusDiv.innerHTML="ğŸ Ø§Ù„Ù‡Ø¯ÙŠØ© Ø¬Ø§Ù‡Ø²Ø©";
      btn.disabled=false;
    }else{
      const h=Math.floor(ms/3600000);
      const m=Math.floor(ms%3600000/60000);
      const s=Math.floor(ms%60000/1000);
      statusDiv.innerHTML=`â³ ${h}Ø³ ${m}Ø¯ ${s}Ø«`;
    }
  },1000);
}

btn.onclick=async()=>{
  const u=auth.currentUser;
  if(!u) return;

  const ref=doc(db,"users",u.uid);
  const snap=await getDoc(ref);
  const d=snap.data();

  if(Date.now()-Number(d.lastGift)<DAY) return;

  await updateDoc(ref,{
  balance:Number(d.balance)+GIFT,
  lastGift:Date.now()
});

// ğŸ”” ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
document.getElementById("giftSound").play();

statusDiv.innerHTML="ğŸ‰ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù‡Ø¯ÙŠØ©!";
load(ref);

  statusDiv.innerHTML="ğŸ‰ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù‡Ø¯ÙŠØ©!";
  load(ref);
};
</script>

<script>
function updateClock(){
  const n=new Date();
  document.getElementById("clock").innerHTML=
    `â° ${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}:${String(n.getSeconds()).padStart(2,'0')}`;
}
setInterval(updateClock,1000); updateClock();
</script>

</body><audio id="giftSound" src="https://assets.mixkit.co/active_storage/sfx/2762/2762-preview.mp3"></audio>
</html>
